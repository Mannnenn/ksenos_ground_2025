launch:
  - group:
      - push-ros-namespace:
          namespace: "sbus"

      - group:
          - push-ros-namespace:
              namespace: "manual"

          - node:
              pkg: ksenos_ground
              exec: sbus_get_raw_data
              name: sbus_get_raw_data_node
              remap:
                - from: "sbus_raw_data"
                  to: "sbus_raw"

          - node:
              pkg: ksenos_ground
              exec: sbus_format_data_to_radian
              name: sbus_format_data_to_radian_node
              param:
                - name: "servo_min_count"
                  value: 352
                - name: "servo_max_count"
                  value: 1696
                - name: "servo_min_rad"
                  value: -0.5236 # -30 degrees in radians
                - name: "servo_max_rad"
                  value: 0.5236 # 30 degrees in radians
                - name: "throttle_min_count"
                  value: 352
                - name: "throttle_max_count"
                  value: 1696
                - name: "throttle_min_openness"
                  value: 0.0
                - name: "throttle_max_openness"
                  value: 1.0
                - name: "autopilot_threshold"
                  value: 1000
                - name: "autolanding_threshold"
                  value: 1000
                - name: "dropping_device_threshold_low"
                  value: 900
                - name: "dropping_device_threshold_high"
                  value: 1500
                - name: "autopilot_mode_threshold_low"
                  value: 500
                - name: "autopilot_mode_threshold_high"
                  value: 1500
              remap:
                - from: "sbus_raw_data"
                  to: "sbus_raw"
                - from: "sbus_data"
                  to: "sbus_radian_format"

          - node:
              pkg: ksenos_ground
              exec: sbus_calibration_node
              name: sbus_calibration_node
              param:
                - name: "calibration_duration"
                  value: 3.0
                - name: "input_topic"
                  value: "sbus_radian_format"
                - name: "offset_topic"
                  value: "/sbus/sbus_offset_amount"

          - node:
              pkg: ksenos_ground
              exec: sbus_offset_apply_node
              name: sbus_offset_apply_node_to_control_node
              param:
                - name: "input_topic"
                  value: "sbus_radian_format"
                - name: "offset_topic"
                  value: "/sbus/sbus_offset_amount"
                - name: "output_topic"
                  value: "sbus_data"
                - name: "offset_operation"
                  value: "subtract" # オフセットを引く→サーボ中立位置に補正

      - group:
          - push-ros-namespace:
              namespace: "auto"

          - node:
              pkg: ksenos_ground
              exec: sbus_offset_apply_node
              name: sbus_offset_apply_node_to_aircraft_node
              param:
                - name: "input_topic"
                  # value: "/sbus/manual/sbus_data"
                  value: "/control_input"
                - name: "offset_topic"
                  value: "/sbus/sbus_offset_amount"
                - name: "output_topic"
                  value: "sbus_radian_format"
                - name: "offset_operation"
                  value: "add" # オフセットを足す

          - node:
              pkg: ksenos_ground
              exec: sbus_format_data_to_raw
              name: sbus_format_data_to_raw_node
              param:
                - name: "servo_min_count"
                  value: 352
                - name: "servo_max_count"
                  value: 1696
                - name: "servo_min_rad"
                  value: -0.5236 # -30 degrees in radians
                - name: "servo_max_rad"
                  value: 0.5236 # 30 degrees in radians
                - name: "throttle_min_count"
                  value: 352
                - name: "throttle_max_count"
                  value: 1696
                - name: "throttle_min_openness"
                  value: 0.0
                - name: "throttle_max_openness"
                  value: 1.0
              remap:
                - from: "sbus_data"
                  to: "sbus_radian_format"
                - from: "sbus_raw_data"
                  to: "sbus_raw_format_input"

          - node:
              pkg: ksenos_ground
              exec: sbus_send_raw_data
              name: sbus_udp_sender
              param:
                - name: udp_ip
                  value: "10.42.0.2" # ArduinoのIPアドレス
                - name: udp_port
                  value: 9999 # Arduinoの受信ポート
              remap:
                - from: sbus_raw_data
                  to: sbus_raw_format_input
                - from: sbus_manual
                  to: /sbus/manual/sbus_data
