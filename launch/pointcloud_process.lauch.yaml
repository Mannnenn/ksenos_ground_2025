launch:
  # ========================================
  # Topic Configuration
  # ========================================

  - arg:
      name: "lidar_pointcloud_topic_name"
      default: "lidar_points"

  - arg:
      name: "lidar_pointcloud_transformed_topic_name"
      default: "transformed_points"

  - arg:
      name: "map_pointcloud_topic_name"
      default: "map_points"

  - arg:
      name: "target_elevation_topic_name"
      default: "target_pitch_angle"

  - arg:
      name: "bbox_maker_topic_name"
      default: "filer_box_size_maker"

  # ========================================
  # Frame Configuration
  # ========================================

  - arg:
      name: "motor_base_frame"
      default: "motor_base"

  - arg:
      name: "lidar_frame"
      default: "hesai_lidar"

  - arg:
      name: "lidar_center_frame"
      default: "lidar_center"

  - arg:
      name: "origin_frame"
      default: "map"

  - arg:
      name: "motor_rotating_frame"
      default: "motor_rotating"

  - arg:
      name: "motor_base_frame"
      default: "motor_base"

  - arg:
      name: "sensor_base_frame"
      default: "sensor_base"

  - arg:
      name: "hesai_lidar_frame"
      default: "hesai_lidar"

  # ========================================
  # Frame Configuration
  # ========================================

  - arg:
      name: "robot_name"
      default: "ksenos"

  - arg:
      name: "lidar_motor_horizontal_offset"
      default: "0.074"

  - arg:
      name: "lidar_motor_vertical_offset"
      default: "0.03"

  # ========================================
  # PointCloud Processing Nodes
  # ========================================

  - node:
      pkg: "ksenos_ground"
      exec: "tf_smoother"
      name: "tf_smoother"
      output: "log"
      param:
        - name: "source_frame"
          value: "$(var origin_frame)"
        - name: "target_frame"
          value: "$(var robot_name)_0"
        - name: "smoothed_target_frame"
          value: "$(var robot_name)_smooth_0"
        - name: "max_translation_threshold"
          value: 5.0
        - name: "max_rotation_threshold"
          value: 0.75
        - name: "timeout_duration"
          value: 0.5
        - name: "publish_rate"
          value: 10.0
        - name: "smoothing_factor"
          value: 0.65

  - node:
      pkg: "ksenos_ground"
      exec: "estimate_vel"
      name: "estimate_vel_0"
      output: "log"
      param:
        - name: "target_frame"
          value: "$(var origin_frame)"
        - name: "source_frame"
          value: "$(var robot_name)_smooth_0"
        - name: "velocity_topic"
          value: "$(var robot_name)smooth_velocity_0"
        - name: "filter_window_size"
          value: 2
        - name: "velocity_smoothing_factor"
          value: 0.8
        - name: "use_moving_average"
          value: true
        - name: "use_kalman_filter"
          value: false
        - name: "kalman_process_noise"
          value: 0.01
        - name: "kalman_measurement_noise"
          value: 0.05

  - node:
      pkg: ksenos_ground
      exec: pub_area
      name: pub_area

  # ========================================
  # Visualization
  # ========================================

  - node:
      pkg: "rviz2"
      exec: "rviz2"
      name: "rviz2"
      output: "log"
      args: "-d $(find-pkg-share ksenos_ground)/config/LiDAR.rviz"
